## æ¨¡ç³Šæµ‹è¯•

Forge æ”¯æŒåŸºäºå±æ€§çš„æµ‹è¯•ã€‚

åŸºäºå±æ€§çš„æµ‹è¯•æ˜¯ä¸€ç§æµ‹è¯•é€šç”¨è¡Œä¸ºè€Œéå­¤ç«‹åœºæ™¯çš„æ–¹æ³•ã€‚

è®©æˆ‘ä»¬é€šè¿‡ç¼–å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼Œæ‰¾å‡ºæˆ‘ä»¬æ­£åœ¨æµ‹è¯•çš„é€šç”¨å±æ€§ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºåŸºäºå±æ€§çš„æµ‹è¯•æ¥ç†è§£è¿™æ„å‘³ç€ä»€ä¹ˆï¼š

```solidity
{{#include ../../projects/fuzz_testing/test/Safe.t.sol.1:all}}
```

è¿è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬çœ‹åˆ°å®ƒé€šè¿‡äº†ï¼š

```sh
{{#include ../output/fuzz_testing/forge-test-no-fuzz:all}}
```

è¿™ä¸ªå•å…ƒæµ‹è¯•ç¡®å®æµ‹è¯•äº†æˆ‘ä»¬å¯ä»¥ä»å®‰å…¨åˆçº¦ä¸­æå–ä»¥å¤ªå¸ã€‚ç„¶è€Œï¼Œè°åˆèƒ½è¯´å®ƒå¯¹æ‰€æœ‰é‡‘é¢éƒ½æœ‰æ•ˆï¼Œè€Œä¸ä»…ä»…æ˜¯ 1 ä»¥å¤ªå¸å‘¢ï¼Ÿ

è¿™é‡Œçš„é€šç”¨å±æ€§æ˜¯ï¼šç»™å®šä¸€ä¸ªå®‰å…¨ä½™é¢ï¼Œå½“æˆ‘ä»¬æå–æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å¾—åˆ°å®‰å…¨åˆçº¦ä¸­çš„æ‰€æœ‰ä»¥å¤ªå¸ã€‚

Forge ä¼šå°†ä»»ä½•è‡³å°‘æœ‰ä¸€ä¸ªå‚æ•°çš„æµ‹è¯•è§†ä¸ºåŸºäºå±æ€§çš„æµ‹è¯•ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬é‡å†™ï¼š

```solidity
{{#include ../../projects/fuzz_testing/test/Safe.t.sol.2:contract_prelude}}
    // ...

{{#include ../../projects/fuzz_testing/test/Safe.t.sol.2:test}}
}
```

å¦‚æœæˆ‘ä»¬ç°åœ¨è¿è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Forge è¿è¡Œäº†åŸºäºå±æ€§çš„æµ‹è¯•ï¼Œä½†å¯¹äºé«˜å€¼çš„ `amount` å®ƒä¼šå¤±è´¥ï¼š

```sh
$ forge test
{{#include ../output/fuzz_testing/forge-test-fail-fuzz:output}}
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œæµ‹è¯•åˆçº¦è¢«èµ‹äºˆçš„ä»¥å¤ªå¸æ•°é‡æ˜¯ `2**96 wei`ï¼ˆç±»ä¼¼äº DappToolsï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å°† `amount` çš„ç±»å‹é™åˆ¶ä¸º `uint96`ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬ä¸ä¼šå°è¯•å‘é€è¶…è¿‡æˆ‘ä»¬æ‹¥æœ‰çš„æ•°é‡ï¼š

```solidity
{{#include ../../projects/fuzz_testing/test/Safe.t.sol.3:signature}}
```

ç°åœ¨å®ƒé€šè¿‡äº†ï¼š

```sh
{{#include ../output/fuzz_testing/forge-test-success-fuzz:all}}
```

ä½ å¯èƒ½å¸Œæœ›ä½¿ç”¨ [`assume`](../cheatcodes/assume.md) ä½œå¼Šç æ’é™¤æŸäº›æƒ…å†µã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ¨¡ç³Šå™¨å°†ä¸¢å¼ƒè¾“å…¥å¹¶å¼€å§‹æ–°çš„æ¨¡ç³Šè¿è¡Œï¼š

```solidity
function testFuzz_Withdraw(uint96 amount) public {
    vm.assume(amount > 0.1 ether);
    // çœç•¥
}
```

æœ‰ä¸åŒçš„æ–¹æ³•æ¥è¿è¡ŒåŸºäºå±æ€§çš„æµ‹è¯•ï¼Œç‰¹åˆ«æ˜¯å‚æ•°åŒ–æµ‹è¯•å’Œæ¨¡ç³Šæµ‹è¯•ã€‚Forge ä»…æ”¯æŒæ¨¡ç³Šæµ‹è¯•ã€‚

### è§£é‡Šç»“æœ

ä½ å¯èƒ½æ³¨æ„åˆ°æ¨¡ç³Šæµ‹è¯•ä¸å•å…ƒæµ‹è¯•çš„æ€»ç»“æ–¹å¼ç•¥æœ‰ä¸åŒï¼š

- "runs" æŒ‡çš„æ˜¯æ¨¡ç³Šå™¨æµ‹è¯•çš„åœºæ™¯æ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡ç³Šå™¨å°†ç”Ÿæˆ 256 ä¸ªåœºæ™¯ï¼Œä½†ç”¨æˆ·å¯ä»¥è®¾ç½®æ­¤å‚æ•°å’Œå…¶ä»–æµ‹è¯•æ‰§è¡Œå‚æ•°ã€‚æ¨¡ç³Šå™¨é…ç½®è¯¦æƒ…è¯·å‚è§ [`è¿™é‡Œ`](#configuring-fuzz-test-execution)ã€‚
- "Î¼"ï¼ˆå¸Œè…Šå­—æ¯ muï¼‰æ˜¯æ‰€æœ‰æ¨¡ç³Šè¿è¡Œä¸­ä½¿ç”¨çš„å¹³å‡æ°”ä½“é‡
- "~"ï¼ˆæ³¢æµªå·ï¼‰æ˜¯æ‰€æœ‰æ¨¡ç³Šè¿è¡Œä¸­ä½¿ç”¨çš„ä¸­ä½æ°”ä½“é‡

### é…ç½®æ¨¡ç³Šæµ‹è¯•æ‰§è¡Œ

æ¨¡ç³Šæµ‹è¯•æ‰§è¡Œç”±ç”¨æˆ·å¯ä»¥é€šè¿‡ Forge é…ç½®åŸè¯­æ§åˆ¶çš„å‚æ•°ç®¡ç†ã€‚é…ç½®å¯ä»¥å…¨å±€åº”ç”¨æˆ–åœ¨æ¯ä¸ªæµ‹è¯•åŸºç¡€ä¸Šåº”ç”¨ã€‚æœ‰å…³æ­¤ä¸»é¢˜çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§
 ğŸ“š [`å…¨å±€é…ç½®`](../reference/config/testing.md) å’Œ ğŸ“š [`å†…è”é…ç½®`](../reference/config/inline-test-config.md)ã€‚

#### æ¨¡ç³Šæµ‹è¯•å›ºå®šè£…ç½®

å½“ä½ å¸Œæœ›ç¡®ä¿ä¸€ç»„ç‰¹å®šçš„å€¼ç”¨ä½œæ¨¡ç³Šå‚æ•°çš„è¾“å…¥æ—¶ï¼Œå¯ä»¥å®šä¹‰æ¨¡ç³Šæµ‹è¯•å›ºå®šè£…ç½®ã€‚
è¿™äº›å›ºå®šè£…ç½®å¯ä»¥åœ¨æµ‹è¯•ä¸­å£°æ˜ä¸ºï¼š

- ä»¥ `fixture` ä¸ºå‰ç¼€çš„å­˜å‚¨æ•°ç»„ï¼Œåè·Ÿè¦æ¨¡ç³Šçš„å‚æ•°åç§°ã€‚ä¾‹å¦‚ï¼Œå½“æ¨¡ç³Šå‚æ•° `amount` ç±»å‹ä¸º `uint32` æ—¶ï¼Œå¯ä»¥å®šä¹‰ä¸º

```solidity
uint32[] public fixtureAmount = [1, 5, 555];
```

- ä»¥ `fixture` ä¸ºå‰ç¼€çš„å‡½æ•°ï¼Œåè·Ÿè¦æ¨¡ç³Šçš„å‚æ•°åç§°ã€‚å‡½æ•°åº”è¿”å›ç”¨äºæ¨¡ç³Šçš„å€¼æ•°ç»„ï¼ˆå›ºå®šå¤§å°æˆ–åŠ¨æ€ï¼‰ã€‚ä¾‹å¦‚ï¼Œå½“æ¨¡ç³Šå‚æ•°åä¸º `owner` ç±»å‹ä¸º `address` æ—¶ï¼Œå¯ä»¥å®šä¹‰ä¸º

```solidity
function fixtureOwner() public returns (address[] memory)
```

å¦‚æœæä¾›çš„å›ºå®šè£…ç½®å€¼ç±»å‹ä¸è¦æ¨¡ç³Šçš„å‘½åå‚æ•°ç±»å‹ä¸åŒï¼Œåˆ™ä¼šè¢«æ‹’ç»å¹¶å¼•å‘é”™è¯¯ã€‚

ä¸€ä¸ªå¯ä»¥ä½¿ç”¨å›ºå®šè£…ç½®çš„ä¾‹å­æ˜¯é‡ç° `DSChief` æ¼æ´ã€‚è€ƒè™‘ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°

```solidity
    function etch(address yay) public returns (bytes32 slate) {
        bytes32 hash = keccak256(abi.encodePacked(yay));

        slates[hash] = yay;

        return hash;
    }

    function voteSlate(bytes32 slate) public {
        uint weight = deposits[msg.sender];
        subWeight(weight, votes[msg.sender]);
        votes[msg.sender] = slate;
        addWeight(weight, votes[msg.sender]);
    }
```

æ¼æ´å¯ä»¥é€šè¿‡åœ¨ `etch` ä¹‹å‰è°ƒç”¨ `voteSlate`ï¼Œå¹¶å°† `slate` å€¼ä½œä¸º `yay` åœ°å€çš„å“ˆå¸Œæ¥é‡ç°ã€‚ä¸ºäº†ç¡®ä¿æ¨¡ç³Šå™¨åœ¨åŒä¸€è¿è¡Œä¸­åŒ…å«ä» `yay` åœ°å€æ´¾ç”Ÿçš„ `slate` å€¼ï¼Œå¯ä»¥å®šä¹‰ä»¥ä¸‹å›ºå®šè£…ç½®ï¼š

```solidity
    address[] public fixtureYay = [
        makeAddr("yay1"),
        makeAddr("yay2"),
        makeAddr("yay3")
    ];

    bytes32[] public fixtureSlate = [
        keccak256(abi.encodePacked(makeAddr("yay1"))),
        keccak256(abi.encodePacked(makeAddr("yay2"))),
        keccak256(abi.encodePacked(makeAddr("yay3")))
    ];
```

ä»¥ä¸‹å›¾åƒæ˜¾ç¤ºäº†æ¨¡ç³Šå™¨åœ¨å£°æ˜å’Œä¸å£°æ˜å›ºå®šè£…ç½®æ—¶ç”Ÿæˆå€¼çš„æƒ…å†µï¼š
![Fuzzer](../images/fuzzer.png)